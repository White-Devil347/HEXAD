<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/hexad/studentapp/AuthScreens.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/hexad/studentapp/AuthScreens.kt" />
              <option name="originalContent" value="package com.hexad.studentapp&#10;&#10;import android.app.Application&#10;import android.content.Context&#10;import android.os.Build&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.OutlinedTextField&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.SnackbarHost&#10;import androidx.compose.material3.SnackbarHostState&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.unit.dp&#10;import androidx.lifecycle.AndroidViewModel&#10;import kotlinx.coroutines.launch&#10;import androidx.biometric.BiometricPrompt&#10;import androidx.biometric.BiometricManager&#10;import androidx.core.content.ContextCompat&#10;import androidx.fragment.app.FragmentActivity&#10;&#10;class SimpleAuthViewModel(app: Application) : AndroidViewModel(app) {&#10;    private val prefs = app.getSharedPreferences(&quot;auth&quot;, Context.MODE_PRIVATE)&#10;&#10;    fun register(username: String, password: String): Result&lt;Unit&gt; {&#10;        if (username.isBlank() || password.length &lt; 4) return Result.failure(IllegalArgumentException(&quot;Invalid&quot;))&#10;        val key = &quot;user_${'$'}username&quot;&#10;        return if (!prefs.contains(key)) {&#10;            prefs.edit().putString(key, password).apply()&#10;            Result.success(Unit)&#10;        } else Result.failure(IllegalStateException(&quot;Exists&quot;))&#10;    }&#10;&#10;    fun login(username: String, password: String): Result&lt;Unit&gt; {&#10;        val key = &quot;user_${'$'}username&quot;&#10;        val stored = prefs.getString(key, null)&#10;        return if (stored != null &amp;&amp; stored == password) Result.success(Unit) else Result.failure(IllegalArgumentException(&quot;Bad creds&quot;))&#10;    }&#10;}&#10;&#10;@Composable&#10;fun LoginScreen(vm: SimpleAuthViewModel, onRegisterClick: () -&gt; Unit, onLoginSuccess: () -&gt; Unit) {&#10;    val username = remember { mutableStateOf(&quot;&quot;) }&#10;    val pass = remember { mutableStateOf(&quot;&quot;) }&#10;    val snackbar = remember { SnackbarHostState() }&#10;    val scope = rememberCoroutineScope()&#10;&#10;    Scaffold(snackbarHost = { SnackbarHost(snackbar) }) { padding -&gt;&#10;        Column(&#10;            modifier = Modifier.fillMaxSize().padding(padding).padding(24.dp),&#10;            verticalArrangement = Arrangement.Center,&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&quot;Login&quot;)&#10;            Spacer(Modifier.height(12.dp))&#10;            OutlinedTextField(value = username.value, onValueChange = { username.value = it }, label = { Text(&quot;Username&quot;) })&#10;            Spacer(Modifier.height(8.dp))&#10;            OutlinedTextField(value = pass.value, onValueChange = { pass.value = it }, label = { Text(&quot;Password&quot;) }, visualTransformation = PasswordVisualTransformation())&#10;            Spacer(Modifier.height(12.dp))&#10;            Button(onClick = {&#10;                val res = vm.login(username.value.trim(), pass.value)&#10;                if (res.isSuccess) onLoginSuccess() else scope.launch { snackbar.showSnackbar(&quot;Invalid credentials&quot;) }&#10;            }) { Text(&quot;Login&quot;) }&#10;            Spacer(Modifier.height(8.dp))&#10;            Button(onClick = onRegisterClick) { Text(&quot;Go to Register&quot;) }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun RegisterScreen(vm: SimpleAuthViewModel, onRegisterSuccess: () -&gt; Unit, onBack: () -&gt; Unit) {&#10;    val username = remember { mutableStateOf(&quot;&quot;) }&#10;    val pass = remember { mutableStateOf(&quot;&quot;) }&#10;    val snackbar = remember { SnackbarHostState() }&#10;    val scope = rememberCoroutineScope()&#10;&#10;    Scaffold(snackbarHost = { SnackbarHost(snackbar) }) { padding -&gt;&#10;        Column(&#10;            modifier = Modifier.fillMaxSize().padding(padding).padding(24.dp),&#10;            verticalArrangement = Arrangement.Center,&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&quot;Register&quot;)&#10;            Spacer(Modifier.height(12.dp))&#10;            OutlinedTextField(value = username.value, onValueChange = { username.value = it }, label = { Text(&quot;Username&quot;) })&#10;            Spacer(Modifier.height(8.dp))&#10;            OutlinedTextField(value = pass.value, onValueChange = { pass.value = it }, label = { Text(&quot;Password (min 4)&quot;) }, visualTransformation = PasswordVisualTransformation())&#10;            Spacer(Modifier.height(12.dp))&#10;            Button(onClick = {&#10;                val res = vm.register(username.value.trim(), pass.value)&#10;                if (res.isSuccess) onRegisterSuccess() else scope.launch { snackbar.showSnackbar(&quot;User exists or invalid&quot;) }&#10;            }) { Text(&quot;Create Account&quot;) }&#10;            Spacer(Modifier.height(8.dp))&#10;            Button(onClick = onBack) { Text(&quot;Back&quot;) }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun HomeScreen(onLogout: () -&gt; Unit) {&#10;    val snackbar = remember { SnackbarHostState() }&#10;    val scope = rememberCoroutineScope()&#10;    val context = LocalContext.current&#10;    val activity = context.findFragmentActivity()&#10;&#10;    Scaffold(snackbarHost = { SnackbarHost(snackbar) }) { padding -&gt;&#10;        Column(&#10;            modifier = Modifier.fillMaxSize().padding(padding).padding(24.dp),&#10;            verticalArrangement = Arrangement.Center,&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&quot;Welcome!&quot;)&#10;            Spacer(Modifier.height(12.dp))&#10;            Button(onClick = {&#10;                if (activity == null) {&#10;                    scope.launch { snackbar.showSnackbar(&quot;Biometric not supported in this context&quot;) }&#10;                    return@Button&#10;                }&#10;                val biometricManager = BiometricManager.from(activity)&#10;                val can = biometricManager.canAuthenticate(BiometricManager.Authenticators.BIOMETRIC_STRONG)&#10;                if (can != BiometricManager.BIOMETRIC_SUCCESS) {&#10;                    scope.launch { snackbar.showSnackbar(&quot;No enrolled biometrics&quot;) }&#10;                    return@Button&#10;                }&#10;                val executor = ContextCompat.getMainExecutor(activity)&#10;                val prompt = BiometricPrompt(activity, executor, object : BiometricPrompt.AuthenticationCallback() {&#10;                    override fun onAuthenticationSucceeded(result: BiometricPrompt.AuthenticationResult) {&#10;                        scope.launch { snackbar.showSnackbar(&quot;Attendance marked ✔&quot;) }&#10;                    }&#10;                    override fun onAuthenticationError(errorCode: Int, errString: CharSequence) {&#10;                        scope.launch { snackbar.showSnackbar(&quot;Error: ${'$'}errString&quot;) }&#10;                    }&#10;                    override fun onAuthenticationFailed() {&#10;                        scope.launch { snackbar.showSnackbar(&quot;Fingerprint not recognized&quot;) }&#10;                    }&#10;                })&#10;                val promptInfoBuilder = BiometricPrompt.PromptInfo.Builder()&#10;                    .setTitle(&quot;Mark Attendance&quot;)&#10;                    .setSubtitle(&quot;Authenticate to proceed&quot;)&#10;                if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.R) {&#10;                    promptInfoBuilder.setAllowedAuthenticators(BiometricManager.Authenticators.BIOMETRIC_STRONG)&#10;                } else {&#10;                    promptInfoBuilder.setNegativeButtonText(&quot;Cancel&quot;)&#10;                }&#10;                prompt.authenticate(promptInfoBuilder.build())&#10;            }) { Text(&quot;Mark Attendance&quot;) }&#10;            Spacer(Modifier.height(12.dp))&#10;            Button(onClick = onLogout) { Text(&quot;Logout&quot;) }&#10;        }&#10;    }&#10;}&#10;&#10;private fun Context.findFragmentActivity(): FragmentActivity? = when (this) {&#10;    is FragmentActivity -&gt; this&#10;    is android.content.ContextWrapper -&gt; baseContext.findFragmentActivity()&#10;    else -&gt; null&#10;}&#10;" />
              <option name="updatedContent" value="package com.hexad.studentapp&#10;&#10;import android.app.Application&#10;import android.content.Context&#10;import android.content.Intent&#10;import android.os.Build&#10;import android.provider.Settings&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.OutlinedTextField&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.SnackbarHost&#10;import androidx.compose.material3.SnackbarHostState&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.unit.dp&#10;import androidx.lifecycle.AndroidViewModel&#10;import kotlinx.coroutines.launch&#10;import androidx.biometric.BiometricPrompt&#10;import androidx.biometric.BiometricManager&#10;import androidx.core.content.ContextCompat&#10;import androidx.fragment.app.FragmentActivity&#10;&#10;class SimpleAuthViewModel(app: Application) : AndroidViewModel(app) {&#10;    private val prefs = app.getSharedPreferences(&quot;auth&quot;, Context.MODE_PRIVATE)&#10;&#10;    fun register(username: String, password: String): Result&lt;Unit&gt; {&#10;        if (username.isBlank() || password.length &lt; 4) return Result.failure(IllegalArgumentException(&quot;Invalid&quot;))&#10;        val key = &quot;user_${'$'}username&quot;&#10;        return if (!prefs.contains(key)) {&#10;            prefs.edit().putString(key, password).apply()&#10;            Result.success(Unit)&#10;        } else Result.failure(IllegalStateException(&quot;Exists&quot;))&#10;    }&#10;&#10;    fun login(username: String, password: String): Result&lt;Unit&gt; {&#10;        val key = &quot;user_${'$'}username&quot;&#10;        val stored = prefs.getString(key, null)&#10;        return if (stored != null &amp;&amp; stored == password) Result.success(Unit) else Result.failure(IllegalArgumentException(&quot;Bad creds&quot;))&#10;    }&#10;}&#10;&#10;@Composable&#10;fun LoginScreen(vm: SimpleAuthViewModel, onRegisterClick: () -&gt; Unit, onLoginSuccess: () -&gt; Unit) {&#10;    val username = remember { mutableStateOf(&quot;&quot;) }&#10;    val pass = remember { mutableStateOf(&quot;&quot;) }&#10;    val snackbar = remember { SnackbarHostState() }&#10;    val scope = rememberCoroutineScope()&#10;&#10;    Scaffold(snackbarHost = { SnackbarHost(snackbar) }) { padding -&gt;&#10;        Column(&#10;            modifier = Modifier.fillMaxSize().padding(padding).padding(24.dp),&#10;            verticalArrangement = Arrangement.Center,&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&quot;Login&quot;)&#10;            Spacer(Modifier.height(12.dp))&#10;            OutlinedTextField(value = username.value, onValueChange = { username.value = it }, label = { Text(&quot;Username&quot;) })&#10;            Spacer(Modifier.height(8.dp))&#10;            OutlinedTextField(value = pass.value, onValueChange = { pass.value = it }, label = { Text(&quot;Password&quot;) }, visualTransformation = PasswordVisualTransformation())&#10;            Spacer(Modifier.height(12.dp))&#10;            Button(onClick = {&#10;                val res = vm.login(username.value.trim(), pass.value)&#10;                if (res.isSuccess) onLoginSuccess() else scope.launch { snackbar.showSnackbar(&quot;Invalid credentials&quot;) }&#10;            }) { Text(&quot;Login&quot;) }&#10;            Spacer(Modifier.height(8.dp))&#10;            Button(onClick = onRegisterClick) { Text(&quot;Go to Register&quot;) }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun RegisterScreen(vm: SimpleAuthViewModel, onRegisterSuccess: () -&gt; Unit, onBack: () -&gt; Unit) {&#10;    val username = remember { mutableStateOf(&quot;&quot;) }&#10;    val pass = remember { mutableStateOf(&quot;&quot;) }&#10;    val snackbar = remember { SnackbarHostState() }&#10;    val scope = rememberCoroutineScope()&#10;&#10;    Scaffold(snackbarHost = { SnackbarHost(snackbar) }) { padding -&gt;&#10;        Column(&#10;            modifier = Modifier.fillMaxSize().padding(padding).padding(24.dp),&#10;            verticalArrangement = Arrangement.Center,&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&quot;Register&quot;)&#10;            Spacer(Modifier.height(12.dp))&#10;            OutlinedTextField(value = username.value, onValueChange = { username.value = it }, label = { Text(&quot;Username&quot;) })&#10;            Spacer(Modifier.height(8.dp))&#10;            OutlinedTextField(value = pass.value, onValueChange = { pass.value = it }, label = { Text(&quot;Password (min 4)&quot;) }, visualTransformation = PasswordVisualTransformation())&#10;            Spacer(Modifier.height(12.dp))&#10;            Button(onClick = {&#10;                val res = vm.register(username.value.trim(), pass.value)&#10;                if (res.isSuccess) onRegisterSuccess() else scope.launch { snackbar.showSnackbar(&quot;User exists or invalid&quot;) }&#10;            }) { Text(&quot;Create Account&quot;) }&#10;            Spacer(Modifier.height(8.dp))&#10;            Button(onClick = onBack) { Text(&quot;Back&quot;) }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun HomeScreen(onLogout: () -&gt; Unit) {&#10;    val snackbar = remember { SnackbarHostState() }&#10;    val scope = rememberCoroutineScope()&#10;    val context = LocalContext.current&#10;    val activity = context.findFragmentActivity()&#10;&#10;    Scaffold(snackbarHost = { SnackbarHost(snackbar) }) { padding -&gt;&#10;        Column(&#10;            modifier = Modifier.fillMaxSize().padding(padding).padding(24.dp),&#10;            verticalArrangement = Arrangement.Center,&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&quot;Welcome!&quot;)&#10;            Spacer(Modifier.height(12.dp))&#10;            Button(onClick = {&#10;                if (activity == null) {&#10;                    scope.launch { snackbar.showSnackbar(&quot;Biometric not supported here&quot;) }&#10;                    return@Button&#10;                }&#10;                val authenticators = BiometricManager.Authenticators.BIOMETRIC_STRONG or BiometricManager.Authenticators.DEVICE_CREDENTIAL&#10;                val biometricManager = BiometricManager.from(activity)&#10;                when (biometricManager.canAuthenticate(authenticators)) {&#10;                    BiometricManager.BIOMETRIC_ERROR_NONE_ENROLLED -&gt; {&#10;                        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.R) {&#10;                            val enrollIntent = Intent(Settings.ACTION_BIOMETRIC_ENROLL).putExtra(&#10;                                Settings.EXTRA_BIOMETRIC_AUTHENTICATORS_ALLOWED, authenticators&#10;                            )&#10;                            activity.startActivity(enrollIntent)&#10;                        } else {&#10;                            scope.launch { snackbar.showSnackbar(&quot;Enroll fingerprint or set device lock&quot;) }&#10;                        }&#10;                        return@Button&#10;                    }&#10;                    BiometricManager.BIOMETRIC_SUCCESS -&gt; { /* proceed */ }&#10;                    else -&gt; {&#10;                        scope.launch { snackbar.showSnackbar(&quot;Biometric unavailable&quot;) }&#10;                        return@Button&#10;                    }&#10;                }&#10;&#10;                val executor = ContextCompat.getMainExecutor(activity)&#10;                val prompt = BiometricPrompt(activity, executor, object : BiometricPrompt.AuthenticationCallback() {&#10;                    override fun onAuthenticationSucceeded(result: BiometricPrompt.AuthenticationResult) {&#10;                        scope.launch { snackbar.showSnackbar(&quot;Attendance marked ✔&quot;) }&#10;                    }&#10;                    override fun onAuthenticationError(errorCode: Int, errString: CharSequence) {&#10;                        scope.launch { snackbar.showSnackbar(&quot;Error: ${'$'}errString&quot;) }&#10;                    }&#10;                    override fun onAuthenticationFailed() {&#10;                        scope.launch { snackbar.showSnackbar(&quot;Not recognized&quot;) }&#10;                    }&#10;                })&#10;&#10;                val promptInfoBuilder = BiometricPrompt.PromptInfo.Builder()&#10;                    .setTitle(&quot;Mark Attendance&quot;)&#10;                    .setSubtitle(&quot;Authenticate to proceed&quot;)&#10;                if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.R) {&#10;                    promptInfoBuilder.setAllowedAuthenticators(authenticators)&#10;                } else {&#10;                    // On Android 10 and below, allow device credentials fallback&#10;                    @Suppress(&quot;DEPRECATION&quot;)&#10;                    promptInfoBuilder.setDeviceCredentialAllowed(true)&#10;                }&#10;                prompt.authenticate(promptInfoBuilder.build())&#10;            }) { Text(&quot;Mark Attendance&quot;) }&#10;            Spacer(Modifier.height(12.dp))&#10;            Button(onClick = onLogout) { Text(&quot;Logout&quot;) }&#10;        }&#10;    }&#10;}&#10;&#10;private fun Context.findFragmentActivity(): FragmentActivity? = when (this) {&#10;    is FragmentActivity -&gt; this&#10;    is android.content.ContextWrapper -&gt; baseContext.findFragmentActivity()&#10;    else -&gt; null&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>